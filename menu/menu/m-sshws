#!/bin/bash

# ==========================================================
#  TOMATO LUXE THEME ENGINE - SSH & OVPN MENU
# ==========================================================

# 1. Palette Definition (True Color)
C_TOMATO="\033[38;2;217;69;57m"   # Primary Red
C_BURGUNDY="\033[38;2;143;38;38m" # Border Red
C_SAGE="\033[38;2;148;180;159m"   # Success Green
C_GOLD="\033[38;2;230;203;165m"   # Warning/Highlight
C_CREAM="\033[38;2;253;251;247m"  # Text
C_RESET="\033[0m"

# 2. Icons
ICON_TOMATO="🍅"
ICON_SSH="🚀"
ICON_ADD="➕"
ICON_TRIAL="⏳"
ICON_RENEW="🔄"
ICON_CHECK="🔍"
ICON_LIST="📜"
ICON_DEL="🗑️"
ICON_LOCK="🔒"
ICON_UNLOCK="🔓"
ICON_KILL="☠️"
ICON_STAR="✨"
ICON_EXIT="🔙"

# ==========================================================
#  PERMISSION CHECK
# ==========================================================
IPVPES="https://raw.githubusercontent.com/dudul19/tomato/main/izin"

function checking_sc() {
    ipsaya=$(curl -sS ipv4.icanhazip.com)
    data_server=$(curl -v --insecure --silent https://google.com/ 2>&1 | grep Date | sed -e 's/< Date: //')
    date_list=$(date +"%Y-%m-%d" -d "$data_server")
    
    useexp=$(wget -qO- $IPVPES | grep $ipsaya | awk '{print $3}')
    
    if [[ "$date_list" < "$useexp" ]]; then
        return 0
    else
        clear
        echo -e "${C_BURGUNDY}╔══════════════════════════════════════════════════════╗${C_RESET}"
        echo -e "${C_BURGUNDY}║${C_RESET}              ${C_TOMATO}🚫 ACCESS DENIED 🚫${C_RESET}                     ${C_BURGUNDY}║${C_RESET}"
        echo -e "${C_BURGUNDY}╠══════════════════════════════════════════════════════╣${C_RESET}"
        echo -e "${C_BURGUNDY}║${C_RESET} ${C_GOLD}Your VPS IP has been banned or not registered!${C_RESET}       ${C_BURGUNDY}║${C_RESET}"
        echo -e "${C_BURGUNDY}║${C_RESET}                                                      ${C_BURGUNDY}║${C_RESET}"
        printf "${C_BURGUNDY}║${C_RESET} ${C_CREAM}%-12s${C_RESET} : ${C_TOMATO}%-35s${C_RESET} ${C_BURGUNDY}║${C_RESET}\n" "IP Address" "$ipsaya"
        printf "${C_BURGUNDY}║${C_RESET} ${C_CREAM}%-12s${C_RESET} : ${C_SAGE}%-35s${C_RESET} ${C_BURGUNDY}║${C_RESET}\n" "Contact" "t.me/dudulrealnofek"
        echo -e "${C_BURGUNDY}╚══════════════════════════════════════════════════════╝${C_RESET}"
        exit 1
    fi
}

# Perform Check
checking_sc

# ==========================================================
#  UI FUNCTIONS
# ==========================================================

draw_header() {
    clear
    # Ambil Domain
    domain=$(cat /etc/xray/domain 2>/dev/null || echo "No Domain")
    
    echo -e "${C_BURGUNDY}╔══════════════════════════════════════════════════════╗${C_RESET}"
    echo -e "${C_BURGUNDY}║${C_RESET} ${C_SAGE}${ICON_TOMATO}    ${C_TOMATO}TOMATO MANAGER${C_RESET} ${C_GOLD}(SSH & OPENVPN)${C_RESET}            ${C_BURGUNDY}║${C_RESET}"
    echo -e "${C_BURGUNDY}╠══════════════════════════════════════════════════════╣${C_RESET}"
    echo -e "${C_BURGUNDY}║${C_RESET} ${C_GOLD}${ICON_STAR} AUTHOR : ${C_CREAM}DUDUL (TEA V.1.0)${C_RESET}                   ${C_BURGUNDY}║${C_RESET}"
    echo -e "${C_BURGUNDY}║${C_RESET} ${C_SAGE}${ICON_SSH} HOST   : ${C_CREAM}$domain${C_RESET}                  ${C_BURGUNDY}║${C_RESET}"
    echo -e "${C_BURGUNDY}╚══════════════════════════════════════════════════════╝${C_RESET}"
    echo -e ""
}

# ==========================================================
#  MAIN MENU
# ==========================================================

draw_header

# --- Account Management ---
echo -e "${C_BURGUNDY}╔══════════════════════════════════════════════════════╗${C_RESET}"
echo -e "${C_BURGUNDY}║${C_RESET}                 ${C_GOLD}ACCOUNT MANAGEMENT${C_RESET}                   ${C_BURGUNDY}║${C_RESET}"
echo -e "${C_BURGUNDY}╠══════════════════════════════════════════════════════╣${C_RESET}"
echo -e "${C_BURGUNDY}║${C_RESET} ${C_GOLD}[01]${C_RESET} ${C_CREAM}Create Account${C_RESET}        ${C_SAGE}${ICON_ADD}${C_RESET}                        ${C_BURGUNDY}║${C_RESET}"
echo -e "${C_BURGUNDY}║${C_RESET} ${C_GOLD}[02]${C_RESET} ${C_CREAM}Trial Account${C_RESET}         ${C_SAGE}${ICON_TRIAL}${C_RESET}                        ${C_BURGUNDY}║${C_RESET}"
echo -e "${C_BURGUNDY}║${C_RESET} ${C_GOLD}[03]${C_RESET} ${C_CREAM}Renew Account${C_RESET}         ${C_SAGE}${ICON_RENEW}${C_RESET}                        ${C_BURGUNDY}║${C_RESET}"
echo -e "${C_BURGUNDY}╠══════════════════════════════════════════════════════╣${C_RESET}"

# --- User Management ---
echo -e "${C_BURGUNDY}║${C_RESET}                   ${C_GOLD}USER MONITORING${C_RESET}                    ${C_BURGUNDY}║${C_RESET}"
echo -e "${C_BURGUNDY}╠══════════════════════════════════════════════════════╣${C_RESET}"
echo -e "${C_BURGUNDY}║${C_RESET} ${C_GOLD}[04]${C_RESET} ${C_CREAM}Check Login${C_RESET}           ${C_SAGE}${ICON_CHECK}${C_RESET}                        ${C_BURGUNDY}║${C_RESET}"
echo -e "${C_BURGUNDY}║${C_RESET} ${C_GOLD}[05]${C_RESET} ${C_CREAM}Member List${C_RESET}           ${C_SAGE}${ICON_LIST}${C_RESET}                        ${C_BURGUNDY}║${C_RESET}"
echo -e "${C_BURGUNDY}║${C_RESET} ${C_GOLD}[06]${C_RESET} ${C_CREAM}Delete Account${C_RESET}        ${C_TOMATO}${ICON_DEL}${C_RESET}                        ${C_BURGUNDY}║${C_RESET}"
echo -e "${C_BURGUNDY}║${C_RESET} ${C_GOLD}[07]${C_RESET} ${C_CREAM}Delete Expired${C_RESET}        ${C_TOMATO}${ICON_DEL}${C_RESET}                        ${C_BURGUNDY}║${C_RESET}"
echo -e "${C_BURGUNDY}╠══════════════════════════════════════════════════════╣${C_RESET}"

# --- Security & Settings ---
echo -e "${C_BURGUNDY}║${C_RESET}                  ${C_GOLD}SECURITY TOOLS${C_RESET}                      ${C_BURGUNDY}║${C_RESET}"
echo -e "${C_BURGUNDY}╠══════════════════════════════════════════════════════╣${C_RESET}"
echo -e "${C_BURGUNDY}║${C_RESET} ${C_GOLD}[08]${C_RESET} ${C_CREAM}AutoKill Setup${C_RESET}        ${C_TOMATO}${ICON_KILL}${C_RESET}                        ${C_BURGUNDY}║${C_RESET}"
echo -e "${C_BURGUNDY}║${C_RESET} ${C_GOLD}[09]${C_RESET} ${C_CREAM}Check MultiLogin${C_RESET}      ${C_SAGE}${ICON_CHECK}${C_RESET}                        ${C_BURGUNDY}║${C_RESET}"
echo -e "${C_BURGUNDY}║${C_RESET} ${C_GOLD}[10]${C_RESET} ${C_CREAM}Lock User${C_RESET}             ${C_TOMATO}${ICON_LOCK}${C_RESET}                        ${C_BURGUNDY}║${C_RESET}"
echo -e "${C_BURGUNDY}║${C_RESET} ${C_GOLD}[11]${C_RESET} ${C_CREAM}Unlock User${C_RESET}           ${C_SAGE}${ICON_UNLOCK}${C_RESET}                        ${C_BURGUNDY}║${C_RESET}"
echo -e "${C_BURGUNDY}╠══════════════════════════════════════════════════════╣${C_RESET}"
echo -e "${C_BURGUNDY}║${C_RESET} ${C_TOMATO}[x]${C_RESET} ${C_TOMATO}Back to Main Menu${C_RESET}     ${C_GOLD}${ICON_EXIT}${C_RESET}                        ${C_BURGUNDY}║${C_RESET}"
echo -e "${C_BURGUNDY}╚══════════════════════════════════════════════════════╝${C_RESET}"
echo -e ""

read -p "  Select From Options : " menu
echo -e ""

case $menu in
    1|01)
        addssh
        ;;
    2|02)
        trial
        ;;
    3|03)
        renewssh
        ;;
    4|04)
        cekssh
        ;;
    5|05)
        member
        ;;
    6|06)
        delssh
        ;;
    7|07)
        delexp
        ;;
    8|08)
        autokill
        ;;
    9|09)
        ceklim
        ;;
    10)
        clear
        lock
        ;;
    11)
        clear
        unlock
        ;;
    x|X)
        menu
        ;;
    *)
        echo -e "  ${C_TOMATO}Please enter a valid number!${C_RESET}"
        sleep 1
        m-ssh
        ;;
esac