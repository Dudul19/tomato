#!/bin/bash

# ==========================================================
#  TOMATO LUXE THEME ENGINE - DELETE BOT
# ==========================================================

# 1. Palette Definition (True Color)
C_TOMATO="\033[38;2;217;69;57m"   # Primary Red
C_BURGUNDY="\033[38;2;143;38;38m" # Border Red
C_SAGE="\033[38;2;148;180;159m"   # Success Green
C_GOLD="\033[38;2;230;203;165m"   # Warning/Highlight
C_CREAM="\033[38;2;253;251;247m"  # Text
C_RESET="\033[0m"

# 2. Icons
ICON_TOMATO="🍅"
ICON_TRASH="🗑️"
ICON_STAR="✨"
ICON_ROBOT="🤖"
ICON_CHECK="✔"
ICON_CROSS="✖"
ICON_GEAR="⚙"

# ==========================================================
#  HELPER FUNCTIONS
# ==========================================================

draw_header() {
    clear
    echo -e "${C_BURGUNDY}╔══════════════════════════════════════════════════════╗${C_RESET}"
    echo -e "${C_BURGUNDY}║${C_RESET} ${C_SAGE}${ICON_TOMATO}    ${C_TOMATO}TOMATO MANAGER${C_RESET} ${C_GOLD}(DELETE BOT)${C_RESET}                 ${C_BURGUNDY}║${C_RESET}"
    echo -e "${C_BURGUNDY}╠══════════════════════════════════════════════════════╣${C_RESET}"
    echo -e "${C_BURGUNDY}║${C_RESET} ${C_GOLD}${ICON_STAR} AUTHOR : ${C_CREAM}DUDUL (TEA V.1.0)${C_RESET}                   ${C_BURGUNDY}║${C_RESET}"
    echo -e "${C_BURGUNDY}╚══════════════════════════════════════════════════════╝${C_RESET}"
    echo -e ""
}

print_status() {
    echo -e "  ${C_GOLD}${ICON_GEAR} $1...${C_RESET}"
    sleep 0.5
}

# ==========================================================
#  MAIN LOGIC
# ==========================================================

draw_header

BOT_DB="/etc/bot/.bot.db"

# 1. Check if Bot Data Exists
# Menggunakan -s untuk cek file ada DAN tidak kosong
if [[ ! -s "$BOT_DB" ]]; then
    echo -e "${C_BURGUNDY}  .----------------------------------------------------.${C_RESET}"
    echo -e "${C_BURGUNDY}  |${C_RESET}                 ${C_TOMATO}NO DATA FOUND${C_RESET}                      ${C_BURGUNDY}|${C_RESET}"
    echo -e "${C_BURGUNDY}  '----------------------------------------------------'${C_RESET}"
    echo -e ""
    echo -e "  ${C_TOMATO}${ICON_CROSS} You have no existing bot configuration.${C_RESET}"
    echo -e ""
    echo -e "${C_BURGUNDY}  ──────────────────────────────────────────────────────${C_RESET}"
    read -n 1 -s -r -p "  Press any key to return..."
    menu
    exit 0
fi

# 2. Retrieve Data Before Deletion (For Log)
CHATID=$(grep -E "^#bot# " "$BOT_DB" | cut -d ' ' -f 3)
KEY=$(grep -E "^#bot# " "$BOT_DB" | cut -d ' ' -f 2)

# 3. Confirmation
echo -e "  ${C_GOLD}[?] Are you sure you want to delete this bot? (y/n)${C_RESET}"
read -p "      > " confirm
if [[ "$confirm" != "y" && "$confirm" != "Y" ]]; then
    menu
    exit 0
fi

echo -e ""
print_status "Removing Bot Configuration"

# 4. Process Deletion
rm -rf "$BOT_DB"
sleep 1

# 5. Success Output
clear
echo -e "${C_BURGUNDY}╔══════════════════════════════════════════════════════╗${C_RESET}"
echo -e "${C_BURGUNDY}║${C_RESET} ${C_TOMATO}${ICON_TRASH}       ${C_GOLD}BOT DELETED SUCCESSFULLY${C_RESET}       ${C_TOMATO}${ICON_TRASH}${C_RESET}        ${C_BURGUNDY}║${C_RESET}"
echo -e "${C_BURGUNDY}╠══════════════════════════════════════════════════════╣${C_RESET}"
echo -e "${C_BURGUNDY}║${C_RESET} ${C_CREAM}The following data has been removed:${C_RESET}                 ${C_BURGUNDY}║${C_RESET}"
echo -e "${C_BURGUNDY}╠══════════════════════════════════════════════════════╣${C_RESET}"
# Format output masking token agar tidak terlalu panjang
KEY_MASKED="${KEY:0:10}......${KEY: -5}"
printf " ${C_BURGUNDY}║${C_RESET} ${C_GOLD}%-12s${C_RESET} ${C_CREAM}: %-35s${C_RESET} ${C_BURGUNDY}║${C_RESET}\n" "Bot Token" "$KEY_MASKED"
printf " ${C_BURGUNDY}║${C_RESET} ${C_GOLD}%-12s${C_RESET} ${C_CREAM}: %-35s${C_RESET} ${C_BURGUNDY}║${C_RESET}\n" "Chat ID" "$CHATID"
echo -e "${C_BURGUNDY}╚══════════════════════════════════════════════════════╝${C_RESET}"

echo -e ""
echo -e "  ${C_GOLD}${ICON_CHECK} Notification system disabled.${C_RESET}"
echo -e ""
read -n 1 -s -r -p "Press any key to return..."
menu